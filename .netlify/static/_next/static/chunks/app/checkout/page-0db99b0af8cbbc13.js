(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{2714:(e,t,s)=>{"use strict";s.d(t,{J:()=>o});var a=s(5155),i=s(2115),l=s(968),n=s(2085),r=s(3999);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(l.b,{ref:t,className:(0,r.cn)(c(),s),...i})});o.displayName=l.b.displayName},4380:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var a=s(5155),i=s(2115),l=s(1509),n=s(5695),r=s(8482),c=s(7168),o=s(9852),d=s(2714),m=s(3999),u=s(1154),x=s(7368),p=s(5855),h=s(1886),f=s(6671),j=s(8184),y=s(4186);function v(e){let{items:t,onSelect:s,loading:l}=e,[n,o]=(0,i.useState)(null),[d,m]=(0,i.useState)([]),[x,p]=(0,i.useState)({}),[v,b]=(0,i.useState)(!1),[N,g]=(0,i.useState)(null),[w,S]=(0,i.useState)(null);async function P(){b(!0);try{var e;if(null===w){let e=(await (0,h.Nh)()).find(e=>"Special"===e.name);S((null==e?void 0:e.id)||null)}let s=w||(null===(e=(await (0,h.Nh)()).find(e=>"Special"===e.name))||void 0===e?void 0:e.id),a=t.filter(e=>e.typeId===s),i={};if(a.length>0){let e=await (0,h.z8)(),t=new Set;for(let s of a)e.filter(e=>e.products.some(e=>e.id===s.productId)).forEach(e=>t.add(e.id));for(let e of t){let t=await (0,h.AP)(e);i={...i,...t}}f.o.info("Special items in cart - showing special pickup times only")}else{let e=await (0,h.z8)(),s=t.map(e=>e.productId);for(let t of e){let e=t.products.map(e=>e.id);if(s.every(t=>e.includes(t))){let e=await (0,h.AP)(t.id);i={...i,...e};break}}let a=await (0,h.N8)(6);i={...i,...a}}let l=Object.keys(i).map(e=>({id:e,timestamp:e,amountLeft:i[e].amountLeft,active:i[e].active})).filter(e=>e.active),r={};l.forEach(e=>{try{let t=new Date(e.timestamp),s=(0,j.GP)(t,"MMMM d, yyyy");r[s]||(r[s]=[]),r[s].push(e)}catch(t){console.error("Failed to parse timestamp:",e.timestamp,t)}});let c=Object.keys(r).sort((e,t)=>new Date(e).getTime()-new Date(t).getTime()),d={};c.forEach(e=>{d[e]=r[e].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())}),m(l),p(d),c.length>0&&!n&&o(c[0])}catch(e){console.error("Failed to load timeslots:",e),f.o.error("Failed to load available times"),m([]),p({})}finally{b(!1)}}(0,i.useEffect)(()=>{P()},[]);let k=e=>{g(e)},_=Object.keys(x),E=n&&x[n]||[];return(0,a.jsx)("div",{className:"space-y-6",children:v?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:"Select Pickup Date"}),_.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:_.map(e=>(0,a.jsx)(c.$,{variant:n===e?"default":"outline",className:"h-auto py-4 text-left justify-start",onClick:()=>{o(e),g(null)},children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-semibold",children:e}),(0,a.jsxs)("span",{className:"text-xs opacity-70",children:[x[e].length," time",1!==x[e].length?"s":""," available"]})]})},e))}):(0,a.jsx)(r.Zp,{children:(0,a.jsx)(r.Wu,{className:"pt-6 text-center text-muted-foreground",children:"No available pickup times. Please try again later."})})]}),n&&E.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:"Select Pickup Time"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:E.map(e=>(0,a.jsxs)(c.$,{variant:(null==N?void 0:N.id)===e.id?"default":"outline",className:"h-auto py-4",onClick:()=>k(e),children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2"}),(0,j.GP)(new Date(e.timestamp),"h:mm a")]},e.id))})]}),N&&(0,a.jsx)(c.$,{onClick:()=>{N&&s(N)},disabled:l,size:"lg",className:"w-full",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"Confirm Pickup: ".concat(n," at ").concat((0,j.GP)(new Date(N.timestamp),"h:mm a"))})]})})}let b="pk_live_51KasQqEZvpspKOfSzW7sdVtBJmH1pVuJ7MkqdkFvwMqH1FG2RkSdpI5qDqEzsxeNgUOwODddzocbKqlRu90DAnMA00Y537FNq1";b||console.error("NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY is not set!");let N=b?(0,x.c)(b):null;function g(e){let{clientSecret:t,paymentIntentId:s,orderData:n,customerName:r,customerEmail:o,customerPhone:d,total:x,onSuccess:j}=e,y=(0,p.useStripe)(),v=(0,p.useElements)(),{clearCart:b}=(0,l._)(),[N,g]=(0,i.useState)(!1),w=async e=>{if(e.preventDefault(),!r||!o||!d){f.o.error("Please fill in all contact information");return}if(!y||!v||!n){console.error("Stripe not ready:",{stripe:!!y,elements:!!v,orderData:!!n}),f.o.error("Payment system not ready. Please try again.");return}g(!0);try{let{error:e}=await v.submit();if(e){f.o.error(e.message||"Payment failed"),g(!1);return}if(!y.createPaymentMethod)throw Error("Stripe instance is not properly initialized. Please check your Stripe publishable key.");let{error:t,paymentMethod:a}=await y.createPaymentMethod({elements:v,params:{billing_details:{name:r,email:o,phone:d||void 0}}});if(t||!a){f.o.error((null==t?void 0:t.message)||"Failed to create payment method"),g(!1);return}console.log("Payment method created:",{id:a.id,type:a.type,card:a.card});let i={amount:Math.round(100*x),currency:"usd",orderId:n.id||null,email:o,phone:d,name:r,paymentInfo:{intent:s,payment_method:a.id}};console.log("Sending paymentIntentInfo:",i),await (0,h.fM)(n,i),j(),setTimeout(()=>{b()},500),f.o.success("Order placed successfully!")}catch(e){console.error("Payment error:",e),f.o.error(e.message||"Failed to process payment"),g(!1)}};return(0,a.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,a.jsx)(p.PaymentElement,{options:{wallets:{applePay:"auto",googlePay:"auto"},fields:{billingDetails:{name:"never",email:"never",phone:"never"}}}}),(0,a.jsx)(c.$,{type:"submit",disabled:!y||N,className:"w-full",size:"lg",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Pay ".concat((0,m.vv)(x))})]})}function w(){var e;let{items:t,total:s,subtotal:x,tax:j,isLoaded:y}=(0,l._)(),w=(0,n.useRouter)(),[S,P]=(0,i.useState)("time"),[k,_]=(0,i.useState)(""),[E,I]=(0,i.useState)(""),[C,T]=(0,i.useState)(!1),[D,F]=(0,i.useState)(""),[q,B]=(0,i.useState)(""),[M,L]=(0,i.useState)(""),[O,R]=(0,i.useState)(null),[z,Z]=(0,i.useState)(null);if(!y)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(0===t.length&&"confirmation"!==S)return null;let A=O&&D&&q&&M?{email:q,name:D,phone:M,items:t.map(e=>({productId:e.productId,quantity:e.quantity,price:e.price,product_size_id:e.product_size_id,selections:e.selections,add_ons:e.add_ons})),total:s,pickupTime:null==O?void 0:O.timestamp,notes:"",status:"pending"}:null,W=async e=>{R(e),T(!0);try{let e=await (0,h.f)(Math.round(100*s));console.log("Payment intent response:",e);let t=e.clientSecret||e.client_secret,a=e.id;if(!t)throw Error("No client secret in response");if(!a)throw Error("No payment intent ID in response");_(t),I(a),P("payment")}catch(e){console.error("Failed to create payment intent:",e),f.o.error(e.message||"Failed to initialize payment"),T(!1)}finally{T(!1)}},$=async e=>{e.preventDefault()};return(0,a.jsx)("div",{className:"container px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:"Checkout"}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{className:"flex-1 text-center ".concat("time"===S?"text-primary font-semibold":"payment"===S||"confirmation"===S?"text-primary":"text-muted-foreground"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ".concat("time"===S?"bg-primary text-white":"payment"===S||"confirmation"===S?"bg-primary text-white":"bg-gray-200"),children:"confirmation"===S?"✓":"1"}),(0,a.jsx)("span",{className:"text-sm",children:"Pickup Time"})]}),(0,a.jsx)("div",{className:"flex-1 border-t"}),(0,a.jsxs)("div",{className:"flex-1 text-center ".concat("payment"===S?"text-primary font-semibold":"confirmation"===S?"text-primary":"text-muted-foreground"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ".concat("payment"===S?"bg-primary text-white":"confirmation"===S?"bg-primary text-white":"bg-gray-200"),children:"confirmation"===S?"✓":"2"}),(0,a.jsx)("span",{className:"text-sm",children:"Payment"})]}),(0,a.jsx)("div",{className:"flex-1 border-t"}),(0,a.jsxs)("div",{className:"flex-1 text-center ".concat("confirmation"===S?"text-primary font-semibold":"text-muted-foreground"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ".concat("confirmation"===S?"bg-primary text-white":"bg-gray-200"),children:"3"}),(0,a.jsx)("span",{className:"text-sm",children:"Confirmation"})]})]}),"time"===S&&(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{children:"Select Pickup Time"})}),(0,a.jsxs)(r.Wu,{children:[(0,a.jsx)(v,{items:t,onSelect:W,loading:C}),(0,a.jsx)(c.$,{variant:"outline",onClick:()=>w.push("/cart"),className:"w-full mt-4",children:"Back to Cart"})]})]}),"payment"===S&&(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{children:"Payment & Contact Information"})}),(0,a.jsxs)(r.Wu,{className:"space-y-6",children:[(0,a.jsxs)("form",{onSubmit:$,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"name",children:"Full Name *"}),(0,a.jsx)(o.p,{id:"name",value:D,onChange:e=>F(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"email",children:"Email *"}),(0,a.jsx)(o.p,{id:"email",type:"email",value:q,onChange:e=>B(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"phone",children:"Phone Number *"}),(0,a.jsx)(o.p,{id:"phone",type:"tel",value:M,onChange:e=>L(e.target.value),required:!0})]})]}),(0,a.jsxs)("div",{className:"border-t pt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Payment Details"}),b?k&&N?(0,a.jsx)(p.Elements,{stripe:N,options:{clientSecret:k,paymentMethodCreation:"manual",appearance:{theme:"flat",variables:{colorPrimary:"#ffb038"}}},children:(0,a.jsx)(g,{clientSecret:k,paymentIntentId:E,orderData:A||{},customerName:D,customerEmail:q,customerPhone:M,total:s,onSuccess:()=>{Z({customerName:D,customerEmail:q,customerPhone:M,selectedTimeslot:O,items:t,subtotal:x,tax:j,total:s}),P("confirmation")}})}):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{children:"Loading payment form..."})]}):(0,a.jsx)("div",{className:"text-center py-8 text-destructive",children:(0,a.jsx)("p",{children:"Stripe is not configured. Please set NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY in your environment variables."})})]}),(0,a.jsx)(c.$,{variant:"outline",onClick:()=>P("time"),className:"w-full",children:"Back"})]})]}),"confirmation"===S&&z&&(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{children:"Order Confirmed!"})}),(0,a.jsxs)(r.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Thank you for your order!"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Your order has been placed successfully."})]}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Pickup Details"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(null===(e=z.selectedTimeslot)||void 0===e?void 0:e.timestamp)?(0,m.r6)(z.selectedTimeslot.timestamp):"Time selected"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Contact Information"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[z.customerName,(0,a.jsx)("br",{}),z.customerEmail,(0,a.jsx)("br",{}),z.customerPhone]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Order Total"}),(0,a.jsx)("p",{className:"text-lg font-bold",children:(0,m.vv)(z.total)})]})]}),(0,a.jsx)(c.$,{className:"w-full",size:"lg",onClick:()=>w.push("/"),children:"Return to Home"})]})]}),"confirmation"!==S&&t.length>0&&(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{children:"Order Summary"})}),(0,a.jsxs)(r.Wu,{className:"space-y-4",children:[t.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{children:[e.quantity,"x ",e.product_name]}),(0,a.jsx)("span",{children:(0,m.vv)(e.price*e.quantity)})]},t)),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsx)("span",{children:(0,m.vv)(x)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Tax"}),(0,a.jsx)("span",{children:(0,m.vv)(j)})]}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsx)("span",{children:(0,m.vv)(s)})]})]})]})]}),"confirmation"===S&&z&&(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{children:"Order Summary"})}),(0,a.jsxs)(r.Wu,{className:"space-y-4",children:[z.items&&z.items.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{children:[e.quantity,"x ",e.product_name||"Item"]}),(0,a.jsx)("span",{children:(0,m.vv)(e.price*e.quantity)})]},t)),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsx)("span",{children:(0,m.vv)(z.subtotal||0)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Tax"}),(0,a.jsx)("span",{children:(0,m.vv)(z.tax||0)})]}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsx)("span",{children:(0,m.vv)(z.total)})]})]})]})]})]})})}},7286:(e,t,s)=>{Promise.resolve().then(s.bind(s,4380))},9852:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(5155),i=s(2115),l=s(3999);let n=i.forwardRef((e,t)=>{let{className:s,type:i,...n}=e;return(0,a.jsx)("input",{type:i,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[455,671,234,91,441,684,358],()=>t(7286)),_N_E=e.O()}]);