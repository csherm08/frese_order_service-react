(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91,904],{1509:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>i,_:()=>l});var a=r(5155),n=r(2115);function s(e){try{let t={productId:e.productId,price:e.price,product_size_id:e.product_size_id||null};if(e.selections&&Object.keys(e.selections).length>0){for(let[r,a]of(t.selections=[],Object.entries(e.selections)))t.selections.push("".concat(r,": ").concat(a.value));t.selections.sort()}if(e.add_ons&&Object.keys(e.add_ons).length>0){for(let[r,a]of(t.add_ons=[],Object.entries(e.add_ons)))if(Array.isArray(a)){let e=r.split("-")[0];a.forEach(r=>{r.value&&t.add_ons.push("".concat(e,": ").concat(r.value))})}t.add_ons.sort()}return JSON.stringify(t)}catch(t){return console.error("Error generating composite key:",t),JSON.stringify({productId:e.productId,product_size_id:e.product_size_id||null})}}var o=r(1886);let c=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,n.useState)([]),[l,d]=(0,n.useState)(null),[u,f]=(0,n.useState)(!1),[p,h]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=localStorage.getItem("cart"),t=localStorage.getItem("cartMode");if(e)try{let r=JSON.parse(e);if(i(r),r.length>0&&t)try{d(JSON.parse(t))}catch(e){console.error("Failed to load cart mode:",e)}else 0===r.length&&d(null)}catch(e){console.error("Failed to load cart:",e)}else if(t){try{let e=JSON.parse(t);console.log("[CartContext] Found saved mode but no cart items, clearing mode:",e)}catch(e){console.error("Failed to parse saved mode:",e)}d(null)}(0,o.Nh)().then(e=>{h(e),f(!0)}).catch(e=>{console.error("Failed to fetch product types:",e),f(!0)})},[]),(0,n.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(r)),l?localStorage.setItem("cartMode",JSON.stringify(l)):localStorage.removeItem("cartMode")},[r,l]);let m=(e,t)=>0===r.length||!e||e.type===t.type&&("special"!==e.type||"special"!==t.type||e.specialId===t.specialId),g=e=>{i(t=>{let r=t.filter((t,r)=>r!==e);return 0===r.length&&d(null),r})},y=e=>{let t=e.price;return e.selections&&Object.values(e.selections).forEach(e=>{e.cost&&(t+=e.cost)}),e.add_ons&&Object.values(e.add_ons).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e.cost&&(t+=e.cost)})}),t},x=e=>{let t=p.find(e=>"Bread"===e.name);return!t||e.typeId!==t.id},v=(0,n.useMemo)(()=>r.reduce((e,t)=>e+y(t)*t.quantity,0),[r]),j=(0,n.useMemo)(()=>{let e=0;for(let t of r)x(t)&&(e+=y(t)*t.quantity*.08);return Math.round(100*e)/100},[r,p]);return(0,a.jsx)(c.Provider,{value:{items:r,cartMode:l,addItem:(e,t)=>(console.log("[CartContext] addItem called:",{item:{productId:e.productId,product_name:e.product_name},mode:t,currentCartMode:l,currentItemsCount:r.length,modesMatch:m(l,t)}),m(l,t))?(l||(console.log("[CartContext] Setting cart mode:",t),d(t)),i(t=>{let r=function(e,t){let r=s(t);return e.findIndex(e=>s(e)===r)}(t,e);return r>=0?t.map((t,a)=>a===r?{...t,quantity:t.quantity+e.quantity}:t):[...t,e]}),!0):(console.warn("[CartContext] Mode conflict detected:",{cartMode:l,requestedMode:t}),!1),removeItem:g,updateQuantity:(e,t)=>{if(t<=0){g(e);return}i(r=>{let a=r.map((r,a)=>a===e?{...r,quantity:t}:r);return 0===a.length&&d(null),a})},clearCart:()=>{i([]),d(null),localStorage.removeItem("cart"),localStorage.removeItem("cartMode")},switchMode:(e,t)=>{i(t?[t]:[]),d(e)},subtotal:v,tax:j,total:v+j,isLoaded:u},children:t})}function l(){let e=(0,n.useContext)(c);if(!e)throw Error("useCart must be used within CartProvider");return e}},1886:(e,t,r)=>{"use strict";r.d(t,{AP:()=>d,N8:()=>l,Nh:()=>s,f:()=>c,fM:()=>i,j0:()=>n,qP:()=>u,z8:()=>o});let a="https://frese-bakery-backend-app-504689514656.us-east1.run.app/api";async function n(){let e=await fetch("".concat(a,"/activeProductsAndSizesIncludingSpecials"));if(!e.ok)throw Error("Failed to fetch products");return e.json()}async function s(){let e=await fetch("".concat(a,"/products/types"));if(!e.ok)throw Error("Failed to fetch product types");return e.json()}async function o(){let e=await fetch("".concat(a,"/activeSpecials?activeOnly=true"));if(!e.ok)throw Error("Failed to fetch specials");return e.json()}async function c(e){let t=await fetch("".concat(a,"/stripe/intent"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to create payment intent"}))).error||"Failed to create payment intent");let r=await t.json();return{clientSecret:r.client_secret||r.clientSecret,...r}}async function i(e,t){let r=await fetch("".concat(a,"/processOrderAndPay"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:e,paymentIntentInfo:t})});if(!r.ok)throw Error((await r.json()).error||"Failed to process order");return r.json()}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t=await fetch("".concat(a,"/orders/availableTimes/").concat(e));if(!t.ok)throw Error("Failed to fetch regular timeslots");return t.json()}async function d(e){let t=await fetch("".concat(a,"/orders/availableSpecialTimes/").concat(e));if(!t.ok)throw Error("Failed to fetch special timeslots");return t.json()}async function u(e){let t=await fetch("".concat(a,"/unsubscribe"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("Failed to unsubscribe");return t.json()}},3999:(e,t,r)=>{"use strict";r.d(t,{Yq:()=>c,cn:()=>s,qj:()=>d,r6:()=>l,vv:()=>o});var a=r(2596),n=r(9688);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}function o(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function c(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}function i(e){return("string"==typeof e?new Date(e):e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function l(e){return"".concat(c(e)," at ").concat(i(e))}function d(e,t){let r="string"==typeof e?new Date(e):e,a="string"==typeof t?new Date(t):t,n=r.toDateString()===a.toDateString(),s=e=>{let t=e.getDate(),r=["th","st","nd","rd"][t%10>3?0:t%100-t%10!=10?t%10:0];return e.toLocaleDateString("en-US",{month:"long",day:"numeric"}).replace(/\d+/,t+r)};return n?"".concat(s(r)," ").concat(i(r)," - ").concat(i(a)):"".concat(s(r)," ").concat(i(r)," - ").concat(s(a)," ").concat(i(a))}},4709:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var a=r(5155),n=r(2115),s=r(8482),o=r(7168),c=r(8145),i=r(1154),l=r(7550),d=r(7809),u=r(4616),f=r(6874),p=r.n(f),h=r(1509),m=r(1886),g=r(3999),y=r(9505),x=r(7092),v=r(6671);function j(){let[e,t]=(0,n.useState)([]),[r,f]=(0,n.useState)(!0),[j,N]=(0,n.useState)(null),[w,b]=(0,n.useState)("all"),[S,_]=(0,n.useState)(null),[C,I]=(0,n.useState)([]),{items:k,addItem:O}=(0,h._)(),E=k.reduce((e,t)=>e+t.quantity,0),F=e=>{O({productId:e.id,product_name:e.title,quantity:1,price:e.special_price||e.price,product_size_id:null,selections:{},add_ons:{},typeId:e.typeId,product:e},{type:"regular"})&&v.o.success("Added ".concat(e.title," to cart"))},A=e=>{!function(e){let t=!!(e.product_sizes&&e.product_sizes.length>0),r=!!(e.product_selection_values&&Object.keys(e.product_selection_values).length>0),a=!!(e.product_add_on_values&&Object.keys(e.product_add_on_values).length>0);return t||r||a}(e)?F(e):N(e)};async function M(){try{let e=await (0,m.Nh)();I(e);let r=e.find(e=>"Special"===e.name),a=null==r?void 0:r.id;_(a);let n=await (0,m.j0)(),s=e.find(e=>"Catering"===e.name),o=null==s?void 0:s.id,c=n.filter(e=>(!a||e.typeId!==a)&&10!==e.typeId&&(!o||e.typeId!==o));t(c)}catch(e){console.error("Failed to load products:",e)}finally{f(!1)}}(0,n.useEffect)(()=>{M()},[]),[...new Set(e.map(e=>e.typeId))];let q="all"===w?e:e.filter(e=>e.typeId===parseInt(w));return r?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsxs)("div",{className:"container px-4 py-8",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(p(),{href:"/order",children:(0,a.jsxs)(o.$,{variant:"ghost",className:"gap-2",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),"Back"]})}),E>0&&(0,a.jsx)(p(),{href:"/cart",children:(0,a.jsxs)(o.$,{className:"gap-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),"View Cart (",E,")"]})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:"Regular Menu"}),(0,a.jsx)("p",{className:"text-lg text-muted-foreground",children:"Fresh baked goods and more, made daily"})]}),(0,a.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[(0,a.jsx)(o.$,{variant:"all"===w?"default":"outline",onClick:()=>b("all"),children:"All Items"}),Array.from(new Set(e.map(e=>e.typeId))).map(e=>{var t;let r=(null===(t=C.find(t=>t.id===e))||void 0===t?void 0:t.name)||"Category ".concat(e);return(0,a.jsx)(o.$,{variant:w===e.toString()?"default":"outline",onClick:()=>b(e.toString()),children:r},e)})]}),(0,a.jsx)("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:q.map(e=>(0,a.jsxs)(s.Zp,{className:"flex flex-col hover:shadow-lg transition-shadow",children:[(0,a.jsx)(s.aR,{className:"p-0",children:e.photoUrl?(0,a.jsx)(x.A,{src:e.photoUrl,alt:e.title,fill:!0,containerClassName:"w-full h-48 rounded-t-xl",className:"rounded-t-xl"}):(0,a.jsx)("div",{className:"w-full h-48 bg-gray-200 rounded-t-xl flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-400",children:"No image"})})}),(0,a.jsxs)(s.Wu,{className:"flex-1 pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsx)(s.ZB,{className:"text-lg",children:e.title}),e.special_price&&(0,a.jsx)(c.E,{variant:"destructive",children:"Sale"})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:e.special_price?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-lg font-bold text-destructive",children:(0,g.vv)(e.special_price)}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground line-through",children:(0,g.vv)(e.price)})]}):(0,a.jsx)("span",{className:"text-lg font-bold",children:(0,g.vv)(e.price)})}),0===e.quantity&&(0,a.jsx)(c.E,{variant:"secondary",children:"Sold Out"})]}),(0,a.jsx)(s.wL,{className:"pt-0",children:(0,a.jsxs)(o.$,{className:"w-full",onClick:()=>A(e),disabled:0===e.quantity,children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Add to Cart"]})})]},e.id))}),0===q.length&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-lg text-muted-foreground",children:"No products found in this category."})}),E>0&&(0,a.jsx)("div",{className:"fixed bottom-4 left-4 right-4 md:hidden",children:(0,a.jsx)(p(),{href:"/cart",children:(0,a.jsxs)(o.$,{className:"w-full h-14 text-lg shadow-lg",children:[(0,a.jsx)(d.A,{className:"mr-2 h-5 w-5"}),"View Cart (",E," items)"]})})})]}),j&&(0,a.jsx)(y.A,{product:j,open:!!j,onClose:()=>N(null),mode:{type:"regular"}})]})}},7168:(e,t,r)=>{"use strict";r.d(t,{$:()=>l,r:()=>i});var a=r(5155),n=r(2115),s=r(9708),o=r(2085),c=r(3999);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:l=!1,...d}=e,u=l?s.DX:"button";return(0,a.jsx)(u,{className:(0,c.cn)(i({variant:n,size:o,className:r})),ref:t,...d})});l.displayName="Button"},8145:(e,t,r)=>{"use strict";r.d(t,{E:()=>c});var a=r(5155);r(2115);var n=r(2085),s=r(3999);let o=(0,n.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{className:(0,s.cn)(o({variant:r}),t),...n})}},8482:(e,t,r)=>{"use strict";r.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>i,Zp:()=>o,aR:()=>c,wL:()=>u});var a=r(5155),n=r(2115),s=r(3999);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...n})});o.displayName="Card";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...n})});c.displayName="CardHeader";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("font-semibold leading-none tracking-tight",r),...n})});i.displayName="CardTitle";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...n})});l.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...n})});u.displayName="CardFooter"},9903:(e,t,r)=>{Promise.resolve().then(r.bind(r,4709))}},e=>{var t=t=>e(e.s=t);e.O(0,[455,874,671,139,385,944,886,441,684,358],()=>t(9903)),_N_E=e.O()}]);