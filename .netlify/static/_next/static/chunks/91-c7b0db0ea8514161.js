"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{1509:(e,t,r)=>{r.d(t,{CartProvider:()=>s,_:()=>l});var o=r(5155),n=r(2115);function a(e){try{let t={productId:e.productId,price:e.price,product_size_id:e.product_size_id||null};if(e.selections&&Object.keys(e.selections).length>0){for(let[r,o]of(t.selections=[],Object.entries(e.selections)))t.selections.push("".concat(r,": ").concat(o.value));t.selections.sort()}if(e.add_ons&&Object.keys(e.add_ons).length>0){for(let[r,o]of(t.add_ons=[],Object.entries(e.add_ons)))if(Array.isArray(o)){let e=r.split("-")[0];o.forEach(r=>{r.value&&t.add_ons.push("".concat(e,": ").concat(r.value))})}t.add_ons.sort()}return JSON.stringify(t)}catch(t){return console.error("Error generating composite key:",t),JSON.stringify({productId:e.productId,product_size_id:e.product_size_id||null})}}var c=r(1886);let i=(0,n.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,n.useState)([]),[l,d]=(0,n.useState)(null),[u,f]=(0,n.useState)(!1),[p,h]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=localStorage.getItem("cart"),t=localStorage.getItem("cartMode");if(e)try{let r=JSON.parse(e);if(s(r),r.length>0&&t)try{d(JSON.parse(t))}catch(e){console.error("Failed to load cart mode:",e)}else 0===r.length&&d(null)}catch(e){console.error("Failed to load cart:",e)}else if(t){try{let e=JSON.parse(t);console.log("[CartContext] Found saved mode but no cart items, clearing mode:",e)}catch(e){console.error("Failed to parse saved mode:",e)}d(null)}(0,c.Nh)().then(e=>{h(e),f(!0)}).catch(e=>{console.error("Failed to fetch product types:",e),f(!0)})},[]),(0,n.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(r)),l?localStorage.setItem("cartMode",JSON.stringify(l)):localStorage.removeItem("cartMode")},[r,l]);let m=(e,t)=>0===r.length||!e||e.type===t.type&&("special"!==e.type||"special"!==t.type||e.specialId===t.specialId),y=e=>{s(t=>{let r=t.filter((t,r)=>r!==e);return 0===r.length&&d(null),r})},g=e=>{let t=e.price;return e.selections&&Object.values(e.selections).forEach(e=>{e.cost&&(t+=e.cost)}),e.add_ons&&Object.values(e.add_ons).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e.cost&&(t+=e.cost)})}),t},v=e=>{let t=p.find(e=>"Bread"===e.name);return!t||e.typeId!==t.id},w=(0,n.useMemo)(()=>r.reduce((e,t)=>e+g(t)*t.quantity,0),[r]),b=(0,n.useMemo)(()=>{let e=0;for(let t of r)v(t)&&(e+=g(t)*t.quantity*.08);return Math.round(100*e)/100},[r,p]);return(0,o.jsx)(i.Provider,{value:{items:r,cartMode:l,addItem:(e,t)=>(console.log("[CartContext] addItem called:",{item:{productId:e.productId,product_name:e.product_name},mode:t,currentCartMode:l,currentItemsCount:r.length,modesMatch:m(l,t)}),m(l,t))?(l||(console.log("[CartContext] Setting cart mode:",t),d(t)),s(t=>{let r=function(e,t){let r=a(t);return e.findIndex(e=>a(e)===r)}(t,e);return r>=0?t.map((t,o)=>o===r?{...t,quantity:t.quantity+e.quantity}:t):[...t,e]}),!0):(console.warn("[CartContext] Mode conflict detected:",{cartMode:l,requestedMode:t}),!1),removeItem:y,updateQuantity:(e,t)=>{if(t<=0){y(e);return}s(r=>{let o=r.map((r,o)=>o===e?{...r,quantity:t}:r);return 0===o.length&&d(null),o})},clearCart:()=>{s([]),d(null),localStorage.removeItem("cart"),localStorage.removeItem("cartMode")},switchMode:(e,t)=>{s(t?[t]:[]),d(e)},subtotal:w,tax:b,total:w+b,isLoaded:u},children:t})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useCart must be used within CartProvider");return e}},1886:(e,t,r)=>{r.d(t,{AP:()=>d,N8:()=>l,Nh:()=>a,f:()=>i,fM:()=>s,j0:()=>n,qP:()=>u,z8:()=>c});let o="https://frese-bakery-backend-app-504689514656.us-east1.run.app/api";async function n(){let e=await fetch("".concat(o,"/activeProductsAndSizesIncludingSpecials"));if(!e.ok)throw Error("Failed to fetch products");return e.json()}async function a(){let e=await fetch("".concat(o,"/products/types"));if(!e.ok)throw Error("Failed to fetch product types");return e.json()}async function c(){let e=await fetch("".concat(o,"/activeSpecials?activeOnly=true"));if(!e.ok)throw Error("Failed to fetch specials");return e.json()}async function i(e){let t=await fetch("".concat(o,"/stripe/intent"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to create payment intent"}))).error||"Failed to create payment intent");let r=await t.json();return{clientSecret:r.client_secret||r.clientSecret,...r}}async function s(e,t){let r=await fetch("".concat(o,"/processOrderAndPay"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:e,paymentIntentInfo:t})});if(!r.ok)throw Error((await r.json()).error||"Failed to process order");return r.json()}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t=await fetch("".concat(o,"/orders/availableTimes/").concat(e));if(!t.ok)throw Error("Failed to fetch regular timeslots");return t.json()}async function d(e){let t=await fetch("".concat(o,"/orders/availableSpecialTimes/").concat(e));if(!t.ok)throw Error("Failed to fetch special timeslots");return t.json()}async function u(e){let t=await fetch("".concat(o,"/unsubscribe"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("Failed to unsubscribe");return t.json()}},3999:(e,t,r)=>{r.d(t,{Yq:()=>i,cn:()=>a,qj:()=>d,r6:()=>l,vv:()=>c});var o=r(2596),n=r(9688);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,o.$)(t))}function c(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function i(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}function s(e){return("string"==typeof e?new Date(e):e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function l(e){return"".concat(i(e)," at ").concat(s(e))}function d(e,t){let r="string"==typeof e?new Date(e):e,o="string"==typeof t?new Date(t):t,n=r.toDateString()===o.toDateString(),a=e=>{let t=e.getDate(),r=["th","st","nd","rd"][t%10>3?0:t%100-t%10!=10?t%10:0];return e.toLocaleDateString("en-US",{month:"long",day:"numeric"}).replace(/\d+/,t+r)};return n?"".concat(a(r)," ").concat(s(r)," - ").concat(s(o)):"".concat(a(r)," ").concat(s(r)," - ").concat(a(o)," ").concat(s(o))}},7168:(e,t,r)=>{r.d(t,{$:()=>l,r:()=>s});var o=r(5155),n=r(2115),a=r(9708),c=r(2085),i=r(3999);let s=(0,c.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((e,t)=>{let{className:r,variant:n,size:c,asChild:l=!1,...d}=e,u=l?a.DX:"button";return(0,o.jsx)(u,{className:(0,i.cn)(s({variant:n,size:c,className:r})),ref:t,...d})});l.displayName="Button"},8482:(e,t,r)=>{r.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>s,Zp:()=>c,aR:()=>i,wL:()=>u});var o=r(5155),n=r(2115),a=r(3999);let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...n})});c.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let s=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("font-semibold leading-none tracking-tight",r),...n})});s.displayName="CardTitle";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...n})});l.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})});u.displayName="CardFooter"}}]);